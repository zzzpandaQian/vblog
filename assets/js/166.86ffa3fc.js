(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{587:function(s,a,t){"use strict";t.r(a);var n=t(24),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"文件云存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件云存储"}},[s._v("#")]),s._v(" 文件云存储")]),s._v(" "),t("h2",{attrs:{id:"_1、概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、概述"}},[s._v("#")]),s._v(" 1、概述")]),s._v(" "),t("p",[s._v("​\t在django项目中，用户上传的文件以及项目中使用的静态文件，默认都是本地存储，保存在服务器中，但是其实我们也可以将它们都保存在云存储中，譬如七牛云存储、阿里云存储、亚马逊云存储等。")]),s._v(" "),t("p",[s._v("​\t本文档使用 七牛云存储")]),s._v(" "),t("h2",{attrs:{id:"_2、本地存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、本地存储"}},[s._v("#")]),s._v(" 2、本地存储")]),s._v(" "),t("h3",{attrs:{id:"_1、建立项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、建立项目"}},[s._v("#")]),s._v(" 1、建立项目")]),s._v(" "),t("p",[s._v("​\t新建django项目，然后：")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("配置数据库")])]),s._v(" "),t("li",[t("p",[s._v("建立模型")])])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UploadFileImg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("models"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Model"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FileField"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("upload_to"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'files/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    img "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ImageField"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("upload_to"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'imgs/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    remark "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("max_length"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("说明：\n模型中文件的处理主要是2个字段类：")]),s._v(" "),t("ul",[t("li",[s._v("FileField：用于一般文件")]),s._v(" "),t("li",[s._v("ImageField：用于图片文件")])]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("迁移数据库")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("python manage.py makemigrations\n\npython manage.py migrate\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_2、settings"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、settings"}},[s._v("#")]),s._v(" 2、settings")]),s._v(" "),t("p",[s._v("settings.py：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("MEDIA_URL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/media/'")]),s._v("\n\nMEDIA_ROOT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BASE_DIR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'media'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("ul",[t("li",[s._v("MEDIA_URL： 在url中访问的path的开头")]),s._v(" "),t("li",[s._v("MEDIA_ROOT：文件存储的位置，一般设置在根目录下的 media 文件夹中，别忘记建立对应的目录")])]),s._v(" "),t("h3",{attrs:{id:"_3、根urls"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、根urls"}},[s._v("#")]),s._v(" 3、根urls")]),s._v(" "),t("p",[s._v("​\t需要在 url 中访问文件，那么需要在 根urls 中增加以下代码：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" settings\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("static "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" static\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" settings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DEBUG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    urlpatterns "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" static"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("settings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MEDIA_URL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" document_root"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("settings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MEDIA_ROOT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_4、admin管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、admin管理"}},[s._v("#")]),s._v(" 4、admin管理")]),s._v(" "),t("p",[s._v("​\t在 admin 中进行管理，那么会自动配置使用 模型字段中的 upload_to 进行文件保存")]),s._v(" "),t("h4",{attrs:{id:"_1-admin管理模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-admin管理模型"}},[s._v("#")]),s._v(" 1. admin管理模型")]),s._v(" "),t("p",[s._v("在admin中：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("admin.site.register(UploadFileImg)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_2-在admin后台中添加数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-在admin后台中添加数据"}},[s._v("#")]),s._v(" 2.在admin后台中添加数据")]),s._v(" "),t("h4",{attrs:{id:"_3-前端显示和下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-前端显示和下载"}},[s._v("#")]),s._v(" 3.前端显示和下载")]),s._v(" "),t("p",[s._v("urls：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'file_admin/<int:pk>/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("file_admin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("模板：在 templates/file_app/file_admin.html ：")]),s._v(" "),t("div",{staticClass:"language-django line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-django"}},[t("code",[t("span",{pre:!0,attrs:{class:"token doctype"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<!")]),t("span",{pre:!0,attrs:{class:"token doctype-tag"}},[s._v("DOCTYPE")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token name"}},[s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("html")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("lang")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("en"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("meta")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("charset")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("UTF-8"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("admin管理的文件显示"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("head")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("ul")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("li")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            备注："),t("span",{pre:!0,attrs:{class:"token django language-django"}},[t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("{{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("uploadFileImg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("remark")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("}}")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("li")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("li")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            图片名："),t("span",{pre:!0,attrs:{class:"token django language-django"}},[t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("{{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("uploadFileImg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("img")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("}}")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("li")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("li")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("img")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),t("span",{pre:!0,attrs:{class:"token django language-django"}},[t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("{{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("uploadFileImg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("img")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("url")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("}}")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("li")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("li")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("a")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("href")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[t("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),t("span",{pre:!0,attrs:{class:"token django language-django"}},[t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("{{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("uploadFileImg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("url")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("}}")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),t("span",{pre:!0,attrs:{class:"token django language-django"}},[t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("{{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("uploadFileImg")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token delimiter punctuation"}},[s._v("}}")])]),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("a")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("li")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("ul")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("body")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("html")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("uploadFileImg.file.url 和 uploadFileImg.img.url 用于获取 文件的url，会自动加上settings中配置的MEDIA_URL")])]),s._v(" "),t("li",[t("p",[s._v("uploadFileImg.file.name 和 uploadFileImg.img.name 用于获取 文件名")])]),s._v(" "),t("li",[t("p",[s._v("通过 a 标签的 href 指定 url，即可实现文件的下载")])])]),s._v(" "),t("p",[s._v("views：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file_admin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        uploadFileImg "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" UploadFileImg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pk"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'file_app/file_admin.html'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'uploadFileImg'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" uploadFileImg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" Http404\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"_3、七牛云存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、七牛云存储"}},[s._v("#")]),s._v(" 3、七牛云存储")]),s._v(" "),t("h3",{attrs:{id:"_1、注册七牛"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、注册七牛"}},[s._v("#")]),s._v(" 1、注册七牛")]),s._v(" "),t("ol",[t("li",[s._v("注册 https://www.qiniu.com/")]),s._v(" "),t("li",[s._v("登录后，访问 个人中心 >> 秘钥管理 ，可以查看到2个key：\n"),t("ul",[t("li",[s._v("AK：ziOjcE7RNZCxwZfOW3WbQzBEHqeN48BLSBcv9uFN")]),s._v(" "),t("li",[s._v("SK：B7A1pkm76FE78jlrVTXYSa2qm7zOPWoqGzNvKcs6")])])]),s._v(" "),t("li",[s._v("进行实名认证")]),s._v(" "),t("li",[s._v("在 对象存储 中，创建 存储空间，得到2个key： 空间名（自己设置，譬如：cloud）、域名(譬如：pxcmwimcw.bkt.clouddn.com)")])]),s._v(" "),t("h3",{attrs:{id:"_2、安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装"}},[s._v("#")]),s._v(" 2、安装")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pip install django-qiniu-storage==2.3.1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3、settings"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、settings"}},[s._v("#")]),s._v(" 3、settings")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对应 秘钥管理中的 AK")]),s._v("\nQINIU_ACCESS_KEY "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ziOjcE7RNZCxwZfOW3WbQzBEHqeN48BLSBcv9uFN'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对应 秘钥管理中的 SK")]),s._v("\nQINIU_SECRET_KEY "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'B7A1pkm76FE78jlrVTXYSa2qm7zOPWoqGzNvKcs6'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对应 存储空间 中的 空间名")]),s._v("\nQINIU_BUCKET_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cloud'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对应 存储空间 的域名")]),s._v("\nQINIU_BUCKET_DOMAIN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pxcmwimcw.bkt.clouddn.com'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用http")]),s._v("\nQINIU_SECURE_URL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("    \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# URL的 scheme 前缀")]),s._v("\nPREFIX_URL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件存储的 前置path")]),s._v("\nMEDIA_ROOT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/media/'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件的URL前缀")]),s._v("\nMEDIA_URL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PREFIX_URL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" QINIU_BUCKET_DOMAIN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" MEDIA_ROOT\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改 默认的文件存储类")]),s._v("\nDEFAULT_FILE_STORAGE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'qiniustorage.backends.QiniuMediaStorage'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("其他的配置项都是七牛云存储私有的，和普通的本地存储的区别就是3个参数的修改：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("MEDIA_ROOT：从普通的：os.path.join(BASE_DIR, 'media') 修改为  '/media/' ，那么存储的默认位置就是 QINIU_BUCKET_DOMAIN + MEDIA_ROOT")])]),s._v(" "),t("li",[t("p",[s._v("MEDIA_URL：  从普通的 '/media/' 修改为 PREFIX_URL + QINIU_BUCKET_DOMAIN + MEDIA_ROOT， 由于使用七牛云存储，因此和我们本身项目的域名不同，因此只能使用绝对路径，而不是普通存储那样的相对路径")])]),s._v(" "),t("li",[t("p",[s._v("DEFAULT_FILE_STORAGE： 这个是重点，因为最终文件的存储，就是由这个类实现的，从默认的 本地存储类修改为 七牛云的存储类，七牛的存储类有3种：")]),s._v(" "),t("ul",[t("li",[s._v("qiniustorage.backends.QiniuStorage：文件将存放在bucket的根目录下")]),s._v(" "),t("li",[s._v("qiniustorage.backends.QiniuMediaStorage：文件将存放在bucket/MEDIA_ROOT目录下")]),s._v(" "),t("li",[s._v("qiniustorage.backends.QiniuStaticStorage：文件将存放在bucket/STATIC_ROOT目录下")])])])]),s._v(" "),t("h3",{attrs:{id:"_4、测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、测试"}},[s._v("#")]),s._v(" 4、测试")]),s._v(" "),t("p",[s._v("​\t在admin后台增加数据，并且在前端显示，这些代码都不需要做任何修改即可")]),s._v(" "),t("h2",{attrs:{id:"_4、七牛云存储静态文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、七牛云存储静态文件"}},[s._v("#")]),s._v(" 4、七牛云存储静态文件")]),s._v(" "),t("p",[s._v("​\t在项目中我们也可以使用云存储保存我们的所有静态文件，只需要几步即可实现")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("settings：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在云存储中保存的文件前置path")]),s._v("\nSTATIC_ROOT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/static/'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 静态文件的url访问路径前置path")]),s._v("\nSTATIC_URL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" QINIU_BUCKET_DOMAIN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" STATIC_ROOT\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 静态文件存储使用的 存储类")]),s._v("\nSTATICFILES_STORAGE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'qiniustorage.backends.QiniuStaticStorage'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("在cmd执行命令：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("python manage.py collectstatic\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("如果出现提示，需要覆盖文件，输入 yes 按回车")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);